function getChildren(e,t){for(var i of e.children)if(i.className===t)return i;return null}document.addEventListener("DOMContentLoaded",()=>{$(".joe_detail__article p:empty").remove(),customElements.define("joe-mtitle",class extends HTMLElement{constructor(){super(),this.innerHTML=`
				<span class="joe_mtitle">
					<span class="joe_mtitle__text">
						${this.getAttribute("title")||"默认标题"}
					</span>
				</span>
			`}}),customElements.define("joe-mp3",class extends HTMLElement{constructor(){super(),this.options={name:this.getAttribute("name"),url:this.getAttribute("url"),theme:this.getAttribute("theme")||"#1989fa",cover:this.getAttribute("cover")||"",autoplay:!!this.getAttribute("autoplay")},this.render()}render(){if(!this.options.url)return this.innerHTML="音频地址未填写！";this.innerHTML='<span style="display: block" class="_content"></span>',new APlayer({container:getChildren(this,"_content"),theme:this.options.theme,autoplay:this.options.autoplay,audio:[{url:this.options.url,name:this.options.name,cover:this.options.cover}]})}}),customElements.define("joe-music",class extends HTMLElement{constructor(){super(),this.options={id:this.getAttribute("id"),color:this.getAttribute("color")||"#1989fa",autoplay:!!this.getAttribute("autoplay")},this.render()}render(){if(!this.options.id)return this.innerHTML="网易云歌曲ID未填写！";this.innerHTML='<span style="display: block" class="_content"></span>',fetch("https://www.vvhan.com/usr/themes/Joe/NeteaseCloudMusicApi.php?id="+this.options.id).then(async e=>{e=await e.json();new APlayer({container:getChildren(this,"_content"),lrcType:1,theme:this.options.color,autoplay:this.options.autoplay,audio:e})})}}),customElements.define("joe-mlist",class extends HTMLElement{constructor(){super(),this.options={id:this.getAttribute("id"),color:this.getAttribute("color")||"#1989fa",autoplay:!!this.getAttribute("autoplay")},this.render()}render(){if(!this.options.id)return this.innerHTML="网易云歌单ID未填写！";this.innerHTML='<span style="display: block" class="_content"></span>',fetch("https://api.i-meto.com/meting/api?server=netease&type=playlist&id="+this.options.id).then(async e=>{e=await e.json();new APlayer({container:getChildren(this,"_content"),lrcType:3,theme:this.options.color,autoplay:this.options.autoplay,audio:e})})}}),customElements.define("joe-abtn",class extends HTMLElement{constructor(){super(),this.options={icon:this.getAttribute("icon")||"",color:this.getAttribute("color")||"#ff6800",href:this.getAttribute("href")||"#",radius:this.getAttribute("radius")||"17.5px",content:this.getAttribute("content")||"多彩按钮"},this.innerHTML=`
                    <a class="joe_abtn" style="background: ${this.options.color}; border-radius: ${this.options.radius}" href="${this.options.href}" target="_blank" rel="noopener noreferrer nofollow">
                        <span class="joe_abtn__icon">
                            <i class="${this.options.icon} fa"></i>
                        </span>
                        <span class="joe_abtn__content">
                            ${this.options.content}
                        </span>
                    </a>
                `}}),customElements.define("joe-anote",class extends HTMLElement{constructor(){super(),this.options={icon:this.getAttribute("icon")||"fa-download",href:this.getAttribute("href")||"#",type:/^secondary$|^success$|^warning$|^error$|^info$/.test(this.getAttribute("type"))?this.getAttribute("type"):"secondary",content:this.getAttribute("content")||"标签按钮"},this.innerHTML=`
					<a class="joe_anote ${this.options.type}" href="${this.options.href}" target="_blank" rel="noopener noreferrer nofollow">
						<span class="joe_anote__icon">
							<i class="fa ${this.options.icon}"></i>
						</span>
						<span class="joe_anote__content">
							${this.options.content}
						</span>
					</a>
				`}}),customElements.define("joe-dotted",class extends HTMLElement{constructor(){super(),this.startColor=this.getAttribute("startColor")||"#ff6c6c",this.endColor=this.getAttribute("endColor")||"#1989fa",this.innerHTML=`
					<span class="joe_dotted" style="background-image: repeating-linear-gradient(-45deg, ${this.startColor} 0, ${this.startColor} 20%, transparent 0, transparent 25%, ${this.endColor} 0, ${this.endColor} 45%, transparent 0, transparent 50%)"></span>
				`}}),customElements.define("joe-cloud",class extends HTMLElement{constructor(){super(),this.options={type:this.getAttribute("type")||"default",title:this.getAttribute("title")||"默认标题",url:this.getAttribute("url"),password:this.getAttribute("password")};this.innerHTML=`
					<span class="joe_cloud">
						<div class="joe_cloud__logo _${this.options.type}"></div>
						<div class="joe_cloud__describe">
							<div class="joe_cloud__describe-title">${this.options.title}</div>
							<div class="joe_cloud__describe-type">来源：${{default:"默认网盘",360:"360网盘",bd:"百度网盘",ty:"天翼网盘",ct:"城通网盘",wy:"微云网盘",github:"Github仓库",gitee:"Gitee仓库",lz:"蓝奏云网盘",ad:"阿里云盘"}[this.options.type]||"默认网盘"}${this.options.password?" | 提取码："+this.options.password:""}</div>
						</div>
						<a class="joe_cloud__btn" href="${this.options.url}" target="_blank" rel="noopener noreferrer nofollow">
							<i class="fa fa-download"></i>
						</a>
					</span>
				`}}),customElements.define("joe-read-limited",class extends HTMLElement{constructor(){super(),this.options={username:this.getAttribute("username"),displayName:this.getAttribute("display-name"),commentName:this.getAttribute("comment-name"),commentKind:this.getAttribute("comment-kind"),commentPlugin:this.getAttribute("comment-plugin")},console.log("JoeReadLimited options:",this.options),this.isUserCommented=!1,this.render(),this.checking=!1,"anonymousUser"!==this.options.username&&("CommentWidgetPlugin"===this.options.commentPlugin?this.commentWidgetPluginCheckComment():"WalinePlugin"===this.options.commentPlugin?this.walineCheckComment():console.warn("JoeReadLimited 评论插件未实现或不可用，不检查评论！"))}commentWidgetPluginCheckComment(){console.log("call commentWidgetPluginCheckComment"),this.runIntervalTask();window.fetch?(window._commentWidgetPluginFetch||(window._commentWidgetPluginFetch=window.fetch),console.log("JoeReadLimited 覆盖 commentWidgetPlugin fetch 请求 ajax 方法！"),window.fetch=(t,i,...e)=>{e=window._commentWidgetPluginFetch(t,i,...e);return e&&"object"==typeof e&&"function"==typeof e.then?e.then(e=>("/apis/api.halo.run/v1alpha1/comments"===t&&"POST"===i.method&&e.ok&&"anonymousUser"!==this.options.username&&!this.isUserCommented&&(console.log("JoeReadLimited commentWidgetPlugin 拦截到用户评论，不再检查评论！"),this.removeReadLimited()),e)):e}):this.checkTimer=setInterval(()=>{this.runIntervalTask()},3e3)}walineCheckComment(){console.log("call walineCheckComment"),this.runIntervalTask(),this.checkTimer=setInterval(()=>{this.runIntervalTask()},3e3)}runIntervalTask(){"anonymousUser"===this.options.username?(console.log("JoeReadLimited 匿名用户，不检查评论！"),this.checkTimer&&clearInterval(this.checkTimer),this.checkTimer=null):this.isUserCommented?(console.log("JoeReadLimited 已经评论过，不再检查评论！"),this.removeReadLimited()):this.checking||(this.checking=!0,this.findFirstMyComment(1,e=>{this.checking=!1,null===e?(console.log("JoeReadLimited 评论查找功能未实现或不可用，不再检查评论！"),this.checkTimer&&clearInterval(this.checkTimer),this.checkTimer=null):e&&(console.log("JoeReadLimited 找到评论，不再检查评论！"),this.isUserCommented=!0,this.removeReadLimited())}))}removeReadLimited(){console.log("call removeReadLimited"),this.checking=!1,this.isUserCommented=!0,this.checkTimer&&clearInterval(this.checkTimer),this.checkTimer=null,$(".joe_read_limited").hide(),$(".joe_detail__article.limited").removeClass("limited"),window._commentWidgetPluginFetch&&(console.log("JoeReadLimited 恢复 commentWidgetPlugin fetch 请求 ajax 方法！"),window.fetch=window._commentWidgetPluginFetch,delete window._commentWidgetPluginFetch)}findFirstMyComment(n,o){const r=this.options.username,l=this.options.displayName;if("anonymousUser"===l)return console.log("findFirstMyComment 匿名用户，不查找评论！, page:",n," ,displayName:",l," ,username:",r),o(null);if("CommentWidgetPlugin"===this.options.commentPlugin){const a=`/apis/api.halo.run/v1alpha1/comments?group=content.halo.run&kind=${this.options.commentKind}&name=${this.options.commentName}&page=${n}&size=20&version=v1alpha1`;void $.ajax({url:a,type:"GET",timeout:1e4}).then(e=>{var t=e.items;if(!t.length)return o(!1);let i=null;for(let e=0;e<t.length;e++){var s=t[e];if(s.owner&&s.owner.displayName===l){i=s;break}}return i?(console.log("findFirstMyComment CommentWidgetPlugin 找到评论！, reqUrl:",a," ,page:",n," ,displayName:",l," ,username:",r," ,userComment:",i),o(!!i)):e.hasNext?this.findFirstMyComment(n+1,o):o(!1)}).catch((e,t,i)=>(console.error("findFirstMyComment CommentWidgetPlugin catch err:",!!e,t,i," ,reqUrl:",a," ,page:",n," ,displayName:",l," ,username:",r),o(!1)))}else{if("WalinePlugin"!==this.options.commentPlugin)return console.warn("findFirstMyComment 未知评论插件，暂不支持查找评论！, page:",n," ,displayName:",l," ,username:",r," ,commentPlugin:",this.options.commentPlugin),o(null);console.warn("findFirstMyComment WalinePlugin 暂不支持查找评论！, page:",n," ,displayName:",l," ,username:",r),o(null)}}render(){this.innerHTML=`<div class="joe_read_limited" data-username="${this.options.username}" data-display-name="${this.options.displayName}" data-comment-name="${this.options.commentName}" data-comment-kind="${this.options.commentKind}">
						<p><i class="joe-font joe-icon-locker" style="color:#f5840d;"></i>
						${"anonymousUser"===this.options.username?'&nbsp;此处内容仅 <span class="joe_read_limited__button need-login">登陆后评论</span> 后可见':"&nbsp;"+this.options.displayName+'您已登陆，此处内容仅 <span class="joe_read_limited__button logined">评论</span> 后可见'}
						</p>
					</div>`,this.$button=this.querySelector(".joe_read_limited__button");const t=document.querySelector(".joe_comment"),i=document.querySelector(".joe_header");var e=$(".joe_detail").attr("data-cid");console.log(e),t&&i&&this.$button.addEventListener("click",e=>{e.stopPropagation(),Boolean(document.querySelector('[id*="comment-"]'))||Boolean(document.querySelector("#waline"))?"anonymousUser"===this.options.username?(console.log("JoeReadLimited 匿名用户，跳转到登录页面！"),window.location.href="/console/login?redirect_uri="+window.location.href):(e=t.offsetTop-i.offsetHeight-15,$("html,body").animate({scrollTop:e},500)):Qmsg.warning("评论功能不可用！")})}}),customElements.define("joe-card-default",class extends HTMLElement{constructor(){super();var e,t=getChildren(this,"_temp"),t=(this.options={width:this.getAttribute("width")||"100%",label:this.getAttribute("label")||"卡片标题",content:t.innerHTML.trim().replace(/^(<br>)|(<br>)$/g,"")||"卡片内容"},`
				<div class="joe_card__default" style="width: ${this.options.width}">
					<div class="joe_card__default-title">${this.options.label}</div>
					<div class="joe_card__default-content">${this.options.content}</div>
				</div>
			`);getChildren(this,"_content")?getChildren(this,"_content").innerHTML=t:((e=document.createElement("span")).style.display="block",e.className="_content",e.innerHTML=t,this.appendChild(e))}}),customElements.define("joe-message",class extends HTMLElement{constructor(){super(),this.options={type:/^success$|^info$|^warning$|^error$/.test(this.getAttribute("type"))?this.getAttribute("type"):"info",content:this.getAttribute("content")||"消息内容"},this.innerHTML=`
					<span class="joe_message ${this.options.type}">
						<span class="joe_message__icon"></span>
						<span class="joe_message__content">${this.options.content}</span>
					</span>
				`}}),customElements.define("joe-progress",class extends HTMLElement{constructor(){super(),this.options={percentage:/^\d{1,3}%$/.test(this.getAttribute("percentage"))?this.getAttribute("percentage"):"50%",color:this.getAttribute("color")||"#ff6c6c"},this.innerHTML=`
				<span class="joe_progress">
					<div class="joe_progress__strip">
						<div class="joe_progress__strip-percent" style="width: ${this.options.percentage}; background: ${this.options.color};"></div>
					</div>
					<div class="joe_progress__percentage">${this.options.percentage}</div>
				</span>
			`}}),customElements.define("joe-callout",class extends HTMLElement{constructor(){super();var e,t=getChildren(this,"_temp"),t=(this.options={color:this.getAttribute("color")||"#f0ad4e",content:t.innerHTML.trim().replace(/^(<br>)|(<br>)$/g,"")||"标注内容"},`
					<div class="joe_callout" style="border-left-color: ${this.options.color};">
						${this.options.content}
					</div>
				`);getChildren(this,"_content")?getChildren(this,"_content").innerHTML=t:((e=document.createElement("span")).style.display="block",e.className="_content",e.innerHTML=t,this.appendChild(e))}}),customElements.define("joe-card-describe",class extends HTMLElement{constructor(){super();var e,t=getChildren(this,"_temp"),t=(this.options={title:this.getAttribute("title")||"卡片描述",content:t.innerHTML.trim().replace(/^(<br>)|(<br>)$/g,"")||"卡片内容"},`
					<div class="joe_card__describe">
						<div class="joe_card__describe-title">${this.options.title}</div>
						<div class="joe_card__describe-content">${this.options.content}</div>
					</div>
				`);getChildren(this,"_content")?getChildren(this,"_content").innerHTML=t:((e=document.createElement("span")).style.display="block",e.className="_content",e.innerHTML=t,this.appendChild(e))}}),customElements.define("joe-card-list",class extends HTMLElement{constructor(){super();var e=getChildren(this,"_temp").innerHTML.trim().replace(/^(<br>)|(<br>)$/g,"");let i="";e.replace(/{card-list-item}([\s\S]*?){\/card-list-item}/g,function(e,t){i+=`<div class="joe_card__list-item">${t.trim().replace(/^(<br>)|(<br>)$/g,"")}</div>`});var t,e=`<div class="joe_card__list">${i}</div>`;getChildren(this,"_content")?getChildren(this,"_content").innerHTML=e:((t=document.createElement("span")).className="_content",t.style.display="block",t.innerHTML=e,this.appendChild(t))}}),customElements.define("joe-alert",class extends HTMLElement{constructor(){super();var e,t=getChildren(this,"_temp"),t=(this.options={type:/^success$|^info$|^warning$|^error$/.test(this.getAttribute("type"))?this.getAttribute("type"):"info",content:t.innerHTML.trim().replace(/^(<br>)|(<br>)$/g,"")||"警告提示"},`
					<div class="joe_alert ${this.options.type}">
						${this.options.content}
					</div>
				`);getChildren(this,"_content")?getChildren(this,"_content").innerHTML=t:((e=document.createElement("span")).style.display="block",e.className="_content",e.innerHTML=t,this.appendChild(e))}}),customElements.define("joe-timeline",class extends HTMLElement{constructor(){super();var e=getChildren(this,"_tpl"),t=e.innerHTML.trim().replace(/^(<br>)|(<br>)$/g,"");let s="";t.replace(/{timeline-item([^}]*)}([\s\S]*?){\/timeline-item}/g,function(e,t,i){s+=`
					<div class="joe_timeline__item">
						<div class="joe_timeline__item-tail"></div>
						<div class="joe_timeline__item-circle" ${t}></div>
						<div class="joe_timeline__item-content">${i.trim().replace(/^(<br>)|(<br>)$/g,"")}</div>
					</div>
				`});var i,t=`<div class="joe_timeline">${s}</div>`;getChildren(this,"_content")?getChildren(this,"_content").innerHTML=t:((i=document.createElement("span")).className="_content",i.style.display="block",i.innerHTML=t,this.appendChild(i)),this.querySelectorAll(".joe_timeline__item-circle").forEach((e,t)=>{var i=e.getAttribute("color")||"#19be6b";e.style.borderColor=i}),e.parentNode.removeChild(e)}}),customElements.define("joe-collapse",class extends HTMLElement{constructor(){super();var e=getChildren(this,"_temp").innerHTML.trim().replace(/^(<br>)|(<br>)$/g,"");let s="";e.replace(/{collapse-item([^}]*)}([\s\S]*?){\/collapse-item}/g,function(e,t,i){s+=`
					<div class="joe_collapse__item" ${t}>
						<div class="joe_collapse__item-head">
							<div class="joe_collapse__item-head--label"></div>
							<svg class="joe_collapse__item-head--icon" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path d="M7.406 7.828L12 12.422l4.594-4.594L18 9.234l-6 6-6-6z"/></svg>
						</div>
						<div class="joe_collapse__item-wrapper">
							<div class="joe_collapse__item-wrapper--content">${i.trim().replace(/^(<br>)|(<br>)$/g,"")}</div>
						</div>
					</div>
				`});var t,e=`<div class="joe_collapse">${s}</div>`;getChildren(this,"_content")?getChildren(this,"_content").innerHTML=e:((t=document.createElement("span")).className="_content",t.style.display="block",t.innerHTML=e,this.appendChild(t)),this.querySelectorAll(".joe_collapse__item").forEach(i=>{var e=i.getAttribute("label")||"折叠标题",t=getChildren(i,"joe_collapse__item-head");getChildren(t,"joe_collapse__item-head--label").innerHTML=e;const s=getChildren(i,"joe_collapse__item-wrapper"),n=getChildren(s,"joe_collapse__item-wrapper--content");null!==i.getAttribute("open")&&(i.classList.add("active"),s.style.maxHeight="none"),t.addEventListener("click",e=>{e.stopPropagation(),s.style.maxHeight=n.offsetHeight+"px";let t=setTimeout(()=>{i.classList.contains("active")?(i.classList.remove("active"),s.style.maxHeight=0):(i.classList.add("active"),s.style.maxHeight=n.offsetHeight+"px"),clearTimeout(t),t=null},30)})})}}),customElements.define("joe-dplayer",class extends HTMLElement{constructor(){super(),this.options={src:this.getAttribute("src")||"",player:this.getAttribute("player")||`${ThemeConfig.BASE_RES_URL}/assets/lib/dplayer/web/${"/themes/theme-Joe3-qiu"===ThemeConfig.BASE_RES_URL?"dplayer":"dplayer-source"}.html?url=`,width:this.getAttribute("width")||"100%",height:this.getAttribute("height")||"500px"},this.render()}render(){this.options.src?this.innerHTML=`<iframe allowfullscreen="true" class="joe_vplayer" src="${this.options.player+this.options.src}" style="width:${this.options.width};height:${this.options.height}"></iframe>`:this.innerHTML="视频地址未填写！"}}),customElements.define("joe-bilibili",class extends HTMLElement{constructor(){super(),this.options={bvid:this.getAttribute("bvid"),page:+(this.getAttribute("page")||"1"),width:this.getAttribute("width")||"100%",height:this.getAttribute("height")||"500px"},this.render()}render(){this.options.bvid?this.innerHTML=`<iframe allowfullscreen="true" class="joe_vplayer" src="//player.bilibili.com/player.html?bvid=${this.options.bvid}&page=${this.options.page}" style="width:${this.options.width};height:${this.options.height}"></iframe>`:this.innerHTML="bvid未填写！"}}),customElements.define("joe-raw-content",class extends HTMLElement{constructor(){super(),this.options={content:this.querySelector("#_raw"),width:this.getAttribute("width")||"unset",height:this.getAttribute("height")||"unset"},this.render()}render(){this.options.content&&this.attachShadow({mode:"closed"}).appendChild(this.options.content)}}),customElements.define("joe-tabs",class extends HTMLElement{constructor(){super();var e=getChildren(this,"_tpl"),t=e.innerHTML.trim().replace(/^(<br>)|(<br>)$/g,"");let s="",n="";t.replace(/{tabs-pane([^}]*)}([\s\S]*?){\/tabs-pane}/g,function(e,t,i){s+=`<div class="joe_tabs__head-item" label="${t}"></div>`,n+=`<div style="display: none" class="joe_tabs__body-item" label="${t}">${i.trim().replace(/^(<br>)|(<br>)$/g,"")}</div>`});var i,t=`
                <div class="joe_tabs">
                    <div class="joe_tabs__head">${s}</div>
                    <div class="joe_tabs__body">${n}</div>
                </div>
            `;getChildren(this,"_content")?getChildren(this,"_content").innerHTML=t:((i=document.createElement("span")).className="_content",i.style.display="block",i.innerHTML=t,this.appendChild(i)),this.querySelectorAll(".joe_tabs__head-item").forEach((t,e)=>{const i=t.getAttribute("label");t.innerHTML=i,t.addEventListener("click",e=>{e.stopPropagation(),this.querySelectorAll(".joe_tabs__head-item").forEach(e=>e.classList.remove("active")),this.querySelectorAll(".joe_tabs__body-item").forEach(e=>e.style.display="none"),this.querySelector(`.joe_tabs__body-item[label="${i}"]`)&&(this.querySelector(`.joe_tabs__body-item[label="${i}"]`).style.display="block"),t.classList.add("active")}),0===e&&t.click()}),e.parentNode.removeChild(e)}}),customElements.define("joe-gird",class extends HTMLElement{constructor(){super(),this.options={column:isNaN(this.getAttribute("column"))||!this.getAttribute("column")?3:this.getAttribute("column"),gap:isNaN(this.getAttribute("gap"))||!this.getAttribute("gap")?15:this.getAttribute("gap")};var e=getChildren(this,"_temp").innerHTML.trim().replace(/^(<br>)|(<br>)$/g,"");let i="";e.replace(/{gird-item}([\s\S]*?){\/gird-item}/g,function(e,t){i+=`<div class="joe_gird__item">${t.trim().replace(/^(<br>)|(<br>)$/g,"")}</div>`});var t,e=`<div class="joe_gird" style="gap: ${this.options.gap}px; grid-template-columns: repeat(${this.options.column}, 1fr);">${i}</div>`;getChildren(this,"_content")?getChildren(this,"_content").innerHTML=e:((t=document.createElement("span")).className="_content",t.style.display="block",t.innerHTML=e,this.appendChild(t))}}),customElements.define("joe-copy",class extends HTMLElement{constructor(){super(),this.options={title:this.getAttribute("title")||"点击复制",content:this.getAttribute("content")||"默认文本",color:this.getAttribute("color")||"inherit",bold:null!=this.getAttribute("bold")?"bold":"normal"},this.innerHTML=`<span class="joe_copy" style="cursor: pointer; user-select: none;font-weight:${this.options.bold};color:${this.options.color};">${this.options.title}</span>`;var e=getChildren(this,"joe_copy");"undefined"!=typeof ClipboardJS&&"undefined"!=typeof Qmsg?new ClipboardJS(e,{text:()=>this.options.content}).on("success",()=>Qmsg.success("复制成功！")):e.addEventListener("click",()=>alert("该功能请前往前台查看！"))}}),$(".joe_detail__article p:empty").remove()});